<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Translation Workbench</title>
  <style>
    /* existing styles */
    body { font-family: sans-serif; }
    .concordance-table { border-collapse: collapse; width: 100%; }
    .concordance-table td { padding: 0.25em 0.5em; }

    /* Highlight matched wordforms */
    .highlight-wordform { background: #f0f0f0; padding: 0.08em 0.25em; border-radius: 3px; }
  </style>
</head>
<body>

  <!-- existing HTML structure -->
  <div id="workbench">
    <!-- ... -->
    <table id="concordance" class="concordance-table"></table>
  </div>

  <script>
    // existing helpers
    function normalizeWord(w) {
      return (w || '').toLowerCase();
    }

    // Toggle concordance display for a given key
    function toggleConcordance(key, show) {
      var table = document.getElementById('concordance');
      if (!table) return;

      // Build set of relevant normalized wordforms for this lemma (minimal change)
      var relevantSet = new Set();
      if (window.lemmaData && window.lemmaData[key]) {
        var ld = window.lemmaData[key];
        if (ld.lemma) relevantSet.add(normalizeWord(ld.lemma));
        if (Array.isArray(ld.wordforms)) {
          ld.wordforms.forEach(function(wf) { relevantSet.add(normalizeWord(wf)); });
        }
      }

      // Build concordance rows (existing behavior preserved)
      var rows = window.concordanceData && window.concordanceData[key] ? window.concordanceData[key] : [];
      table.innerHTML = '';

      rows.forEach(function(r) {
        var tr = document.createElement('tr');

        var leftTd = document.createElement('td');
        var leftSpan = document.createElement('span');
        var leftWord = r.left || '';
        leftSpan.className = 'concordance-word' + (relevantSet.has(normalizeWord(leftWord)) ? ' highlight-wordform' : '');
        leftSpan.textContent = leftWord;
        leftTd.appendChild(leftSpan);

        var centerTd = document.createElement('td');
        centerTd.textContent = r.match || '';

        var rightTd = document.createElement('td');
        var rightSpan = document.createElement('span');
        var rightWord = r.right || '';
        rightSpan.className = 'concordance-word' + (relevantSet.has(normalizeWord(rightWord)) ? ' highlight-wordform' : '');
        rightSpan.textContent = rightWord;
        rightTd.appendChild(rightSpan);

        tr.appendChild(leftTd);
        tr.appendChild(centerTd);
        tr.appendChild(rightTd);
        table.appendChild(tr);
      });

      table.style.display = show ? '' : 'none';
    }

    // export for other scripts
    window.toggleConcordance = toggleConcordance;
  </script>
</body>
</html>
